<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Balances & Holdings - Vanguard Asset Management Portal</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    /* Header - Vanguard Style */
    .header {
      background: #c00;
      color: white;
      padding: 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 60px;
    }

    .header-left {
      display: flex;
      align-items: center;
      height: 100%;
    }

    .logo {
      background: #a00;
      padding: 0 1.5rem;
      height: 100%;
      display: flex;
      align-items: center;
      font-size: 1.75rem;
      font-weight: 700;
      color: white;
      letter-spacing: -0.5px;
    }

    .header-nav {
      display: flex;
      gap: 0;
      height: 100%;
      align-items: stretch;
      margin-left: 2rem;
    }

    .header-nav a {
      color: white;
      text-decoration: none;
      font-size: 0.9375rem;
      font-weight: 500;
      padding: 0 1.25rem;
      display: flex;
      align-items: center;
      border-bottom: 4px solid transparent;
      transition: all 0.2s;
      position: relative;
    }

    .header-nav a:hover {
      background: rgba(0, 0, 0, 0.1);
      border-bottom-color: #ff0;
    }

    .header-nav a.active {
      border-bottom-color: white;
      background: rgba(0, 0, 0, 0.15);
    }

    .header-right {
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-info {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.9);
    }

    /* Main Content */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Filters */
    .filters {
      background: white;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      gap: 1.5rem;
      align-items: center;
      justify-content: space-between;
    }

    .filter-group {
      display: flex;
      gap: 1.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-item {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .filter-item label {
      font-size: 0.875rem;
      color: #6b7280;
      font-weight: 500;
    }

    .filter-item select,
    .filter-item input {
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 0.875rem;
      background: white;
      color: #374151;
    }

    .filter-item select:focus,
    .filter-item input:focus {
      outline: none;
      border-color: #c00;
    }

    #exportBtn {
      padding: 0.625rem 1.25rem;
      background: #c00;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      white-space: nowrap;
    }

    #exportBtn:hover {
      background: #a00;
      box-shadow: 0 2px 8px rgba(204, 0, 0, 0.3);
    }

    #exportBtn::before {
      content: '↓';
      font-size: 1rem;
    }

    /* Holdings Table */
    .table-container {
      background: white;
      padding: 1.5rem;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table th {
      text-align: left;
      font-size: 0.8125rem;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.75rem 1rem;
      border-bottom: 2px solid #e5e7eb;
      cursor: pointer;
      user-select: none;
    }

    table th:hover {
      color: #c00;
    }

    table th.sortable::after {
      content: ' ⇅';
      opacity: 0.3;
    }

    table th.asc::after {
      content: ' ↑';
      opacity: 1;
    }

    table th.desc::after {
      content: ' ↓';
      opacity: 1;
    }

    table td {
      padding: 1rem;
      border-bottom: 1px solid #f3f4f6;
      font-size: 0.9375rem;
      color: #374151;
    }

    table tbody tr:hover {
      background: #f9fafb;
    }

    table tbody tr:nth-child(even) {
      background: #fafafa;
    }

    table tbody tr:nth-child(even):hover {
      background: #f5f5f5;
    }

    .symbol-cell {
      font-weight: 600;
      color: #c00;
    }

    .positive {
      color: #10b981;
      font-weight: 500;
    }

    .negative {
      color: #ef4444;
      font-weight: 500;
    }

    h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #111827;
      margin-bottom: 1rem;
    }

    .total-row {
      font-weight: 600;
      background: #f3f4f6;
      border-top: 2px solid #e5e7eb;
    }

    .total-row td {
      font-weight: 600;
      padding: 1.25rem 1rem;
    }

    .backend-comment {
      display: block;
      font-size: 0.75rem;
      color: #9ca3af;
      font-style: italic;
      margin-top: 0.25rem;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .summary-card {
      background: white;
      padding: 1.25rem;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #c00;
    }

    .summary-card h3 {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    .summary-card .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #111827;
    }
  </style>
</head>
<body>
  <!-- Backend: NavigationServlet.java -->
  <!-- Business Logic: SessionManager.getCurrentUser() -->

  <!-- Header - Vanguard Style -->
  <div class="header">
    <div class="header-left">
      <div class="logo">Vanguard</div>
      <nav class="header-nav">
        <a href="accounts-overview.html">Accounts Overview</a>
        <a href="balances-holdings.html" class="active">Balances & Holdings</a>
        <a href="portfolio-performance.html">Performance</a>
        <a href="transactions.html">Transactions</a>
        <a href="risk-analysis.html">Risk Analysis</a>
      </nav>
    </div>
    <div class="header-right">
      <span class="user-info">Jacob Michelini</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">

    <!-- Backend: HoldingsServlet.java -->
    <!-- Business Logic: HoldingsServiceImpl.getHoldingsSummary(userId) -->

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <h3>Total Value</h3>
        <div class="value">$68,917.42</div>
      </div>
      <div class="summary-card">
        <h3>Total Holdings</h3>
        <div class="value">13</div>
      </div>
      <div class="summary-card">
        <h3>Total Gain/Loss</h3>
        <div class="value positive">+$8,245.67</div>
      </div>
      <div class="summary-card">
        <h3>Day Change</h3>
        <div class="value positive">+$287.42</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <span class="backend-comment"><!-- Backend: HoldingsFilterServlet.java --></span>
      <div class="filter-group">
        <div class="filter-item">
          <label for="filterAccount">Account:</label>
          <select id="filterAccount">
            <option value="all">All Accounts</option>
            <option value="5626">Individual Brokerage (****5626)</option>
            <option value="7182">Roth IRA (****7182)</option>
            <option value="3309">Traditional 401(k) (****3309)</option>
            <option value="9201">Taxable Investment (****9201)</option>
          </select>
        </div>
        <div class="filter-item">
          <label for="dateRangeFilter">As of Date:</label>
          <input type="date" id="dateRangeFilter" value="2024-01-30">
        </div>
      </div>
      <button id="exportBtn">Download Report</button>
    </div>

    <!-- Holdings Table -->
    <div class="table-container">
      <h2>Current Holdings</h2>
      <span class="backend-comment"><!-- Backend: HoldingsServiceImpl.getAllHoldings(userId, accountFilter) --></span>
      <table id="holdingsTable">
        <thead>
          <tr>
            <th class="sortable" data-column="account">Account</th>
            <th class="sortable" data-column="symbol">Symbol</th>
            <th class="sortable" data-column="description">Description</th>
            <th class="sortable" data-column="quantity">Quantity</th>
            <th class="sortable" data-column="price">Price</th>
            <th class="sortable" data-column="value">Value</th>
            <th class="sortable" data-column="dayChange">Day Change</th>
            <th class="sortable" data-column="totalGain">Total Gain/Loss</th>
          </tr>
        </thead>
        <tbody id="holdingsTableBody">
          <!-- Populated by JavaScript -->
        </tbody>
        <tfoot>
          <tr class="total-row">
            <td colspan="5" style="text-align: right;">Total Portfolio Value:</td>
            <td id="totalValue">$0.00</td>
            <td id="totalDayChange" class="positive">+$0.00</td>
            <td id="totalGain" class="positive">+$0.00</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <script>
    // Mock holdings data - Jacob Michelini's portfolio
    // Backend would call: HoldingsServiceImpl.getAllHoldings(userId)
    const holdings = [
      { account: '****5626', symbol: 'VTI', description: 'Vanguard Total Stock Market ETF', quantity: 75, price: 249.20, value: 18690.00, dayChangeAmt: 112.35, dayChangePct: 0.6, totalGainAmt: 2690.00, totalGainPct: 16.8 },
      { account: '****5626', symbol: 'VTSAX', description: 'Vanguard Total Stock Market Index', quantity: 25, price: 118.45, value: 2961.25, dayChangeAmt: 14.80, dayChangePct: 0.5, totalGainAmt: 461.25, totalGainPct: 18.4 },
      { account: '****5626', symbol: 'BND', description: 'Vanguard Total Bond Market ETF', quantity: 100, price: 72.18, value: 7218.00, dayChangeAmt: 7.22, dayChangePct: 0.1, totalGainAmt: -282.00, totalGainPct: -3.8 },

      { account: '****7182', symbol: 'VXUS', description: 'Vanguard Total International Stock', quantity: 120, price: 61.82, value: 7418.40, dayChangeAmt: 24.72, dayChangePct: 0.3, totalGainAmt: 918.40, totalGainPct: 14.1 },
      { account: '****7182', symbol: 'VTSAX', description: 'Vanguard Total Stock Market Index', quantity: 80, price: 118.45, value: 9476.00, dayChangeAmt: 47.38, dayChangePct: 0.5, totalGainAmt: 1476.00, totalGainPct: 18.4 },
      { account: '****7182', symbol: 'VTI', description: 'Vanguard Total Stock Market ETF', quantity: 30, price: 249.20, value: 7476.00, dayChangeAmt: 44.94, dayChangePct: 0.6, totalGainAmt: 1076.00, totalGainPct: 16.8 },

      { account: '****3309', symbol: 'VFIAX', description: 'Vanguard 500 Index Fund Admiral', quantity: 20, price: 421.35, value: 8427.00, dayChangeAmt: 42.13, dayChangePct: 0.5, totalGainAmt: 927.00, totalGainPct: 12.4 },
      { account: '****3309', symbol: 'VBTLX', description: 'Vanguard Total Bond Market Index', quantity: 35, price: 105.92, value: 3707.20, dayChangeAmt: 3.71, dayChangePct: 0.1, totalGainAmt: -92.80, totalGainPct: -2.4 },
      { account: '****3309', symbol: 'VXUS', description: 'Vanguard Total International Stock', quantity: 5, price: 61.82, value: 309.10, dayChangeAmt: 1.03, dayChangePct: 0.3, totalGainAmt: 9.10, totalGainPct: 3.0 },

      { account: '****9201', symbol: 'VTI', description: 'Vanguard Total Stock Market ETF', quantity: 10, price: 249.20, value: 2492.00, dayChangeAmt: 14.95, dayChangePct: 0.6, totalGainAmt: 392.00, totalGainPct: 18.7 },
      { account: '****9201', symbol: 'BND', description: 'Vanguard Total Bond Market ETF', quantity: 8, price: 72.18, value: 577.44, dayChangeAmt: 0.58, dayChangePct: 0.1, totalGainAmt: -22.56, totalGainPct: -3.8 },
      { account: '****9201', symbol: 'VMFXX', description: 'Vanguard Federal Money Market', quantity: 131, price: 1.00, value: 131.03, dayChangeAmt: 0.00, dayChangePct: 0.0, totalGainAmt: 0.03, totalGainPct: 0.02 },
      { account: '****9201', symbol: 'CASH', description: 'Cash Reserves', quantity: 1, price: 34.00, value: 34.00, dayChangeAmt: 0.00, dayChangePct: 0.0, totalGainAmt: 0.00, totalGainPct: 0.0 }
    ];

    let filteredHoldings = [...holdings];

    // Populate holdings table
    function populateHoldingsTable(data = filteredHoldings) {
      const tbody = document.getElementById('holdingsTableBody');
      tbody.innerHTML = data.map(holding => `
        <tr>
          <td>${holding.account}</td>
          <td class="symbol-cell">${holding.symbol}</td>
          <td>${holding.description}</td>
          <td>${holding.quantity.toLocaleString()}</td>
          <td>$${holding.price.toFixed(2)}</td>
          <td>$${holding.value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          <td class="${holding.dayChangeAmt >= 0 ? 'positive' : 'negative'}">
            ${holding.dayChangeAmt >= 0 ? '+' : ''}$${Math.abs(holding.dayChangeAmt).toFixed(2)} (${holding.dayChangePct.toFixed(1)}%)
          </td>
          <td class="${holding.totalGainAmt >= 0 ? 'positive' : 'negative'}">
            ${holding.totalGainAmt >= 0 ? '+' : ''}$${Math.abs(holding.totalGainAmt).toLocaleString('en-US', { minimumFractionDigits: 2 })} (${holding.totalGainPct.toFixed(1)}%)
          </td>
        </tr>
      `).join('');

      updateTotals(data);
    }

    // Update totals row
    function updateTotals(data) {
      const totalValue = data.reduce((sum, h) => sum + h.value, 0);
      const totalDayChange = data.reduce((sum, h) => sum + h.dayChangeAmt, 0);
      const totalGain = data.reduce((sum, h) => sum + h.totalGainAmt, 0);

      document.getElementById('totalValue').textContent = '$' + totalValue.toLocaleString('en-US', { minimumFractionDigits: 2 });

      const dayChangeEl = document.getElementById('totalDayChange');
      dayChangeEl.textContent = (totalDayChange >= 0 ? '+' : '') + '$' + Math.abs(totalDayChange).toLocaleString('en-US', { minimumFractionDigits: 2 });
      dayChangeEl.className = totalDayChange >= 0 ? 'positive' : 'negative';

      const gainEl = document.getElementById('totalGain');
      gainEl.textContent = (totalGain >= 0 ? '+' : '') + '$' + Math.abs(totalGain).toLocaleString('en-US', { minimumFractionDigits: 2 });
      gainEl.className = totalGain >= 0 ? 'positive' : 'negative';
    }

    // Filter functionality
    function filterHoldings() {
      const accountFilter = document.getElementById('filterAccount').value;

      if (accountFilter === 'all') {
        filteredHoldings = [...holdings];
      } else {
        filteredHoldings = holdings.filter(h => h.account.includes(accountFilter));
      }

      populateHoldingsTable(filteredHoldings);
    }

    // Table sorting functionality
    function setupTableSorting() {
      const table = document.getElementById('holdingsTable');
      const headers = table.querySelectorAll('th.sortable');

      headers.forEach(header => {
        header.addEventListener('click', function() {
          const column = this.dataset.column;

          // Toggle sort direction
          const isAscending = this.classList.contains('asc');
          headers.forEach(h => h.classList.remove('asc', 'desc'));
          this.classList.add(isAscending ? 'desc' : 'asc');

          // Sort holdings
          filteredHoldings.sort((a, b) => {
            let aValue = a[column];
            let bValue = b[column];

            // Handle string comparison
            if (typeof aValue === 'string') {
              return isAscending
                ? bValue.localeCompare(aValue)
                : aValue.localeCompare(bValue);
            }

            // Handle numeric comparison
            return isAscending ? bValue - aValue : aValue - bValue;
          });

          populateHoldingsTable(filteredHoldings);
        });
      });
    }

    // Export functionality
    // Backend would call: ReportServiceImpl.exportHoldings(userId, format="CSV")
    document.getElementById('exportBtn').addEventListener('click', function() {
      const csvContent = generateCSV(filteredHoldings);
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'vanguard-holdings-' + new Date().toISOString().split('T')[0] + '.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    });

    function generateCSV(data) {
      const headers = ['Account', 'Symbol', 'Description', 'Quantity', 'Price', 'Value', 'Day Change', 'Total Gain/Loss'];
      const rows = data.map(h => [
        h.account,
        h.symbol,
        h.description,
        h.quantity,
        h.price.toFixed(2),
        h.value.toFixed(2),
        h.dayChangeAmt.toFixed(2),
        h.totalGainAmt.toFixed(2)
      ]);

      return [headers, ...rows].map(row => row.join(',')).join('\n');
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      populateHoldingsTable();
      setupTableSorting();

      // Add filter event listeners
      document.getElementById('filterAccount').addEventListener('change', filterHoldings);
      document.getElementById('dateRangeFilter').addEventListener('change', function() {
        console.log('Date filter changed to:', this.value);
        // In real app: Backend call to fetch holdings for specific date
      });
    });
  </script>
</body>
</html>
